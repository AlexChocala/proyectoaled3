<!-- ENCABEZADO FIJO -->
<div class="dialog-encabezado">
  <h2 mat-dialog-title [ngClass]="esEdicion ? 'titulo-modificar' : 'titulo-alta'">
    {{ esEdicion ? 'MODIFICAR PRODUCTO' : 'NUEVO PRODUCTO' }}
  </h2>
</div>

<!-- CONTENIDO SCROLLABLE -->
<div class="dialog-scrollable">
  <form [formGroup]="formularioProducto" (ngSubmit)="registrar()" class="formulario-contenedor">

    <!-- INPUT NOMBRE -->
    <mat-form-field appearance="outline">
      <mat-label>Nombre</mat-label>
      <input matInput type="text" formControlName="nombre" placeholder="zapatilla" required>
      <ng-container *ngTemplateOutlet="validaCampo; context: { campo: 'nombre' }"></ng-container>
    </mat-form-field>

    <!-- INPUT DESCRIPCION -->
    <mat-form-field appearance="outline">
      <mat-label>Descripcion</mat-label>
      <textarea matInput formControlName="descripcion" placeholder="hermosa zapa para el verano"></textarea>
      <ng-container *ngTemplateOutlet="validaCampo; context: { campo: 'descripcion' }"></ng-container>
    </mat-form-field>

    <!-- INPUT PRECIO -->
    <mat-form-field floatLabel="always" appearance="outline">
      <mat-label>Precio</mat-label>
      <input matInput inputmode="decimal" placeholder="99.99" formControlName="precio">
      <span matTextPrefix>$&nbsp;</span>
      <ng-container *ngTemplateOutlet="validaCampo; context: { campo: 'precio' }"></ng-container>
    </mat-form-field>

    <!-- INPUT CATEGORIA -->
    <mat-form-field floatLabel="always" appearance="outline">
      <mat-label>Categoria</mat-label>
      <mat-select formControlName="categoria">
        <mat-option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</mat-option>
        <!-- modifiquÃ© para usar categorias -->
      </mat-select>
      <ng-container *ngTemplateOutlet="validaCampo; context: { campo: 'categoria' }"></ng-container>
    </mat-form-field>

    <!-- INPUT STOCK (nuevo campo agregado) -->
    <mat-form-field floatLabel="always" appearance="outline">
      <mat-label>Stock</mat-label>
      <mat-select formControlName="stock" required>
        <mat-option *ngFor="let n of numerosStock" [value]="n">{{ n }}</mat-option>
      </mat-select>
      <ng-container *ngTemplateOutlet="validaCampo; context: { campo: 'stock' }"></ng-container>
    </mat-form-field>

    <!-- INPUT IMAGEN -->
    <mat-form-field>
      <mat-label>Imagen del producto</mat-label>
      <input matInput type="url" formControlName="imagen" placeholder="https://...">
      <mat-icon>upload</mat-icon>
      <ng-container *ngTemplateOutlet="validaCampo; context: { campo: 'imagen' }"></ng-container>
    </mat-form-field>

    <!-- BOTONES CONFIRMAR Y CANCELAR -->
    <button mat-raised-button [ngClass]="esEdicion ? 'boton-modificar' : 'boton-alta'" color="primary" type="submit"
      [disabled]="formularioProducto.invalid">
      {{ esEdicion ? 'MODIFICAR' : 'AGREGAR' }}
    </button>
    <button mat-button type="button" (click)="cancelar()">Cancelar</button>
  </form>

  <!-- PLANTILLA REUTILIZABLE -->
  <ng-template #validaCampo let-campo="campo">
    @if (getError(campo)) {
    <mat-error>{{ getError(campo) }}</mat-error>
    } @else if (formularioProducto.get(campo)?.valid) {
    <mat-icon color="accent" class="icono-ok">check_circle</mat-icon>
    }
  </ng-template>
</div>